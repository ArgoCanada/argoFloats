---
title: "Introduction to argoFloats Quality Control"
author: "Dan Kelley (https://orcid.org/0000-0001-7808-5911) and Jaimie Harbin (https://orcid.org/0000-0003-3774-3732)"
date: "`r Sys.Date()`"
---

**Abstract**

# Introduction to Flags
Core, biogeochemical (BGC), and Deep Argo data all undergo testing to ensure the data found at the Data Assembly Centers are as accurate as possible. More specifically, testing in done in three levels:

1: Real time that complete checks on all measurements and assigned a quality flag within a 24-48 hour timeframe
2. Delayed mode
3. Regional scientific analyses of all float data with other available data. The procedures for regional analyses are still to be determined.

*Hypothesis* : Our hypothesis is that real-time data have all NAs for <PARAM>ADJUSTED, and we should therefore only use the <PARAM>ADJUSTED for delayed mode data.

# argoFloats and Flags

As described by the Argo userâ€™s manual V3.3 [1], data that are given a flag value of 1, 2, 5, or 8 are considered 'good' data. If data are given a flag value of 9 (or missing value) they are not used, and flags 3, 5, 6, and 7 are considered 'bad' data.

## Diagnostic Plot
Our `argoFloats` package uses the flags of profiles to determine "good" and "bad" data. We then created a plot type to demonstrate the quality of data, the `diagnostic` plot. The diagnostic plot is a plot of parameter quality and parameter mean. This only works if `x` is an object that was created by `getProfiles()`. The user must also provide the `parameter` of interest. If the user is uncertain about what parameter exists within a certain float, `argoFloats` will prompt the user with the appropriate parameters. 

An example of how to get the diagnostic plot for oxygen, or "DOXY" is as follows:

```{r, message=FALSE, warning=FALSE}
library(argoFloats)
ais <- getIndex(filename = 'synthetic', age=0)
sub <- subset(ais, ID='2902123')
lonRect <- c(56, 66)
latRect <- c(11,12)
s <- subset(sub, rectangle=list(longitude=lonRect, latitude=latRect))
profiles <- getProfiles(s)
argos <- readProfiles(profiles)
plot(argos, which='diagnostic', parameter='oxygen')
```

*Exercise One:* Use the previous code to determine the diagnostics of temperature for float number 4900845. Explain the results.

## showQCTests()
The `showQCTests()` is a newly added function. It's purpose is to use integer values from the [hexToNibble()] function to internally convert hex digits. In this contenxt, the hex digits come from `HISTORY_QCTEST` of a single argoFloats object that was created by [readProfiles()]. The `showQCTests()` is then used to indicate which QC tests were performed and/or failed.

An example of the `showQCTests()` used on a float near the Arabian Sea is as follows:

```{r, message=FALSE, error=FALSE, warning=FALSE}
library(argoFloats)
data('index')
subset <- subset(index, 1)
profiles <- getProfiles(subset)
argos <- readProfiles(profiles)
argos1 <- argos[[1]]
showQCTests(argos[[1]])
```

## applyQC()

*Exercise Two*: Use the first float from ID 4900845 in exercise one,to determine which tests were performed and/or failed during quality control testing.

# Answers
*Exercise One:* Use the previous code to determine the diagnostics of temperature for float number 4900845. Explain the results.
```{r, message=FALSE, error=FALSE, warning=FALSE}
library(argoFloats)
ais <- getIndex(filename = 'synthetic', age=0)
sub <- subset(ais, ID='4900845')
profiles <- getProfiles(sub)
argos <- readProfiles(profiles)
plot(argos, which='diagnostic', parameter='temperature')
```

The results show 100% of the temperature data are considered 'good' data. This is a result of all of the files being 'delayed' mode indicating the argo profiles have undergone scrutinized testing.

*Exercise Two*: Use the first float from ID 4900845 in exercise one,to determine which tests were performed and/or failed during quality control testing.

FIX ME::: REVISIT THIS


```{r, warning=FALSE, error=FALSE, message=FALSE}
ais <- getIndex(filename = 'synthetic', age=0)
sub <- subset(ais, ID='4900845')
profiles <- getProfiles(sub)
argos <- readProfiles(profiles)
a1 <- argos[[1]]
showQCTests(a1)
```

# References
[1] Carval, Thierry, Bob Keeley, Yasushi Takatsuki, Takashi Yoshida, Stephen Loch, Claudia Schmid, Roger Goldsmith et al. "Argo User's Manual, Version 3.2. December 29th 2015.[SUPERSEDED]." (2015).
